diff -up mplayer-export-2025-09-28/configure.7~ mplayer-export-2025-09-28/configure
--- mplayer-export-2025-09-28/configure.7~	2025-09-28 16:27:07.480963520 +0200
+++ mplayer-export-2025-09-28/configure	2025-09-28 16:27:07.603847986 +0200
@@ -9092,6 +9092,7 @@ done
 echo "Creating config.h"
 cat > $TMPH << EOF
 /*----------------------------------------------------------------------------
+** XXX MODIFIED BY CIGAES
 ** This file has been automatically generated by configure any changes in it
 ** will be lost when you run configure again.
 ** Instead of modifying definitions here, use the --enable/--disable options
@@ -9101,6 +9102,9 @@ cat > $TMPH << EOF
 #ifndef MPLAYER_CONFIG_H
 #define MPLAYER_CONFIG_H
 
+#define HAVE_AESNI_EXTERNAL 0
+#define HAVE_INTRINSICS_SSE2 1
+
 /* Undefine this if you do not want to select mono audio (left or right)
    with a stereo MPEG layer 2/3 audio stream. The command line option
    -stereo has three possible values (0 for stereo, 1 for left-only, 2 for
@@ -9777,6 +9781,7 @@ if x86; then
 > "$TMPS"
 echo "%define CONFIG_GPL 1" >> "$TMPS"
 echo "%define HAVE_ALIGNED_STACK 1" >> "$TMPS"
+echo "%define HAVE_AESNI_EXTERNAL 0" >> "$TMPS"
 echo "$(ff_config_enable "$arch_all" "$arch" "%" "ARCH")" >> "$TMPS"
 echo "$(ff_config_enable "$subarch_all" "$subarch" "%" "ARCH")" >> "$TMPS"
 echo "$(ff_config_enable "$cpuexts_all" "$cpuexts_external" "%" "HAVE" "_EXTERNAL")" >> "$TMPS"
diff -up mplayer-export-2025-09-28/gui/util/bitmap.c.7~ mplayer-export-2025-09-28/gui/util/bitmap.c
diff -up mplayer-export-2025-09-28/libaf/af_lavcac3enc.c.7~ mplayer-export-2025-09-28/libaf/af_lavcac3enc.c
--- mplayer-export-2025-09-28/libaf/af_lavcac3enc.c.7~	2024-04-08 23:35:23.000000000 +0200
+++ mplayer-export-2025-09-28/libaf/af_lavcac3enc.c	2025-09-28 16:27:07.605208262 +0200
@@ -100,8 +100,13 @@ static int control(struct af_instance_s
                 s->lavc_actx->sample_rate != af->data->rate ||
                 s->lavc_actx->bit_rate != bit_rate) {
 
-            if (s->lavc_actx->codec)
-                avcodec_close(s->lavc_actx);
+            avcodec_free_context(&s->lavc_actx);
+            s->lavc_actx = avcodec_alloc_context3(NULL);
+            if (!s->lavc_actx) {
+                mp_msg(MSGT_AFILTER, MSGL_ERR, MSGTR_CouldntAllocateLavcContext);
+                return AF_ERROR;
+            }
+
 
             // Put sample parameters
             s->lavc_actx->ch_layout.nb_channels = af->data->nch;
@@ -157,9 +162,7 @@ static void uninit(struct af_instance_s*
         af_ac3enc_t *s = af->setup;
         af->setup = NULL;
         if(s->lavc_actx) {
-            if (s->lavc_actx->codec)
-                avcodec_close(s->lavc_actx);
-            free(s->lavc_actx);
+            avcodec_free_context(&s->lavc_actx);
         }
         free(s->pending_data);
         free(s);
@@ -280,12 +283,6 @@ static int af_open(af_instance_t* af){
         return AF_ERROR;
     }
 
-    s->lavc_actx = avcodec_alloc_context3(NULL);
-    if (!s->lavc_actx) {
-        mp_msg(MSGT_AFILTER, MSGL_ERR, MSGTR_CouldntAllocateLavcContext);
-        return AF_ERROR;
-    }
-
     return AF_OK;
 }
 
diff -up mplayer-export-2025-09-28/libmpcodecs/ad_ffmpeg.c.7~ mplayer-export-2025-09-28/libmpcodecs/ad_ffmpeg.c
--- mplayer-export-2025-09-28/libmpcodecs/ad_ffmpeg.c.7~	2024-04-08 23:35:23.000000000 +0200
+++ mplayer-export-2025-09-28/libmpcodecs/ad_ffmpeg.c	2025-09-28 16:27:07.605385477 +0200
@@ -196,11 +196,9 @@ static void uninit(sh_audio_t *sh)
 {
     AVCodecContext *lavc_context = sh->context;
 
-    if (avcodec_close(lavc_context) < 0)
-	mp_msg(MSGT_DECVIDEO, MSGL_ERR, MSGTR_CantCloseCodec);
     av_freep(&lavc_context->opaque);
     av_freep(&lavc_context->extradata);
-    av_freep(&lavc_context);
+    avcodec_free_context(&lavc_context);
 }
 
 static int control(sh_audio_t *sh,int cmd,void* arg, ...)
diff -up mplayer-export-2025-09-28/libmpcodecs/vd_ffmpeg.c.7~ mplayer-export-2025-09-28/libmpcodecs/vd_ffmpeg.c
--- mplayer-export-2025-09-28/libmpcodecs/vd_ffmpeg.c.7~	2025-09-28 16:27:07.564104835 +0200
+++ mplayer-export-2025-09-28/libmpcodecs/vd_ffmpeg.c	2025-09-28 16:27:07.605598769 +0200
@@ -514,9 +514,6 @@ static void uninit(sh_video_t *sh){
     }
 
     if (avctx) {
-        if (avctx->codec && avcodec_close(avctx) < 0)
-            mp_msg(MSGT_DECVIDEO, MSGL_ERR, MSGTR_CantCloseCodec);
-
         av_freep(&avctx->extradata);
         av_freep(&avctx->hwaccel_context);
     }
@@ -1063,8 +1060,8 @@ static mp_image_t *decode(sh_video_t *sh
 //    mpi->qscale = av_frame_get_qp_table(pic, &mpi->qstride, &mpi->qscale_type);
     mpi->pict_type=pic->pict_type;
     mpi->fields = MP_IMGFIELD_ORDERED;
-    if(pic->interlaced_frame) mpi->fields |= MP_IMGFIELD_INTERLACED;
-    if(pic->top_field_first ) mpi->fields |= MP_IMGFIELD_TOP_FIRST;
+    if(pic->flags & AV_FRAME_FLAG_INTERLACED) mpi->fields |= MP_IMGFIELD_INTERLACED;
+    if(pic->flags &AV_FRAME_FLAG_TOP_FIELD_FIRST ) mpi->fields |= MP_IMGFIELD_TOP_FIRST;
     if(pic->repeat_pict == 1) mpi->fields |= MP_IMGFIELD_REPEAT_FIRST;
 
     return mpi;
diff -up mplayer-export-2025-09-28/libmpcodecs/ve_lavc.c.7~ mplayer-export-2025-09-28/libmpcodecs/ve_lavc.c
--- mplayer-export-2025-09-28/libmpcodecs/ve_lavc.c.7~	2024-04-08 23:32:39.000000000 +0200
+++ mplayer-export-2025-09-28/libmpcodecs/ve_lavc.c	2025-09-28 16:27:07.605852317 +0200
@@ -152,7 +152,7 @@ static int lavc_param_video_global_heade
 static int lavc_param_mv0_threshold = 256;
 static int lavc_param_refs = 1;
 static int lavc_param_b_sensitivity = 40;
-static int lavc_param_level = FF_LEVEL_UNKNOWN;
+static int lavc_param_level = AV_LEVEL_UNKNOWN;
 
 char *lavc_param_acodec = "mp2";
 int lavc_param_atag = 0;
@@ -722,12 +722,12 @@ static int put_image(struct vf_instance
 
     if(lavc_param_interlaced_dct){
         if((mpi->fields & MP_IMGFIELD_ORDERED) && (mpi->fields & MP_IMGFIELD_INTERLACED))
-            pic->top_field_first= !!(mpi->fields & MP_IMGFIELD_TOP_FIRST);
+            pic->flags |= (mpi->fields & MP_IMGFIELD_TOP_FIRST) ? AV_FRAME_FLAG_TOP_FIELD_FIRST : 0;
         else
-            pic->top_field_first= 1;
+            pic->flags |= AV_FRAME_FLAG_TOP_FIELD_FIRST;
 
         if(lavc_param_top!=-1)
-            pic->top_field_first= lavc_param_top;
+            pic->flags= (pic->flags & ~AV_FRAME_FLAG_TOP_FIELD_FIRST) | lavc_param_top ? AV_FRAME_FLAG_TOP_FIELD_FIRST : 0;
     }
 
     return encode_frame(vf, pic, pts) >= 0;
@@ -852,9 +852,6 @@ static void uninit(struct vf_instance *v
     av_freep(&lavc_venc_context->intra_matrix);
     av_freep(&lavc_venc_context->inter_matrix);
 
-    if (lavc_venc_context->codec)
-        avcodec_close(lavc_venc_context);
-
     if(stats_file) fclose(stats_file);
 
     /* free rc_override */
diff -up mplayer-export-2025-09-28/libmpcodecs/vf_mcdeint.c.7~ mplayer-export-2025-09-28/libmpcodecs/vf_mcdeint.c
--- mplayer-export-2025-09-28/libmpcodecs/vf_mcdeint.c.7~	2017-10-22 19:53:38.000000000 +0200
+++ mplayer-export-2025-09-28/libmpcodecs/vf_mcdeint.c	2025-09-28 16:27:07.606075628 +0200
@@ -313,8 +313,7 @@ static void uninit(struct vf_instance *v
     }
 #endif
     if (vf->priv->avctx_enc) {
-    avcodec_close(vf->priv->avctx_enc);
-    av_freep(&vf->priv->avctx_enc);
+        avcodec_free_context(&vf->priv->avctx_enc);
     }
 
     free(vf->priv->outbuf);
diff -up mplayer-export-2025-09-28/libmpcodecs/vf_screenshot.c.7~ mplayer-export-2025-09-28/libmpcodecs/vf_screenshot.c
--- mplayer-export-2025-09-28/libmpcodecs/vf_screenshot.c.7~	2024-09-21 11:30:07.000000000 +0200
+++ mplayer-export-2025-09-28/libmpcodecs/vf_screenshot.c	2025-09-28 16:27:07.606239688 +0200
@@ -279,8 +279,7 @@ static int query_format(struct vf_instan
 
 static void uninit(vf_instance_t *vf)
 {
-    avcodec_close(vf->priv->avctx);
-    av_freep(&vf->priv->avctx);
+    avcodec_free_context(&vf->priv->avctx);
     if(vf->priv->ctx) sws_freeContext(vf->priv->ctx);
     av_freep(&vf->priv->pic->data[0]);
     av_frame_free(&vf->priv->pic);
diff -up mplayer-export-2025-09-28/libmpdemux/demux_lavf.c.7~ mplayer-export-2025-09-28/libmpdemux/demux_lavf.c
--- mplayer-export-2025-09-28/libmpdemux/demux_lavf.c.7~	2024-09-21 11:30:09.000000000 +0200
+++ mplayer-export-2025-09-28/libmpdemux/demux_lavf.c	2025-09-28 16:27:07.606424506 +0200
@@ -367,7 +367,10 @@ static void handle_stream(demuxer_t *dem
                 st->discard= AVDISCARD_ALL;
             if (priv->audio_streams == 0) {
                 size_t rg_size;
-                AVReplayGain *rg = (AVReplayGain*)av_stream_get_side_data(st, AV_PKT_DATA_REPLAYGAIN, &rg_size);
+                const AVPacketSideData *sd = av_packet_side_data_get(st->codecpar->coded_side_data,
+                                                                     st->codecpar->nb_coded_side_data,
+                                                                     AV_PKT_DATA_REPLAYGAIN);
+                AVReplayGain *rg = sd ? (AVReplayGain*)sd->data : NULL;
                 if (rg && rg_size >= sizeof(*rg)) {
                     priv->r_gain = rg->track_gain / 10000;
                 }
@@ -378,7 +381,10 @@ static void handle_stream(demuxer_t *dem
         }
         case AVMEDIA_TYPE_VIDEO:{
             AVDictionaryEntry *rot = av_dict_get(st->metadata, "rotate",   NULL, 0);
-            const int32_t *disp_matrix = (const int32_t *)av_stream_get_side_data(st, AV_PKT_DATA_DISPLAYMATRIX, NULL);
+            const AVPacketSideData *sd = av_packet_side_data_get(st->codecpar->coded_side_data,
+                                                                 st->codecpar->nb_coded_side_data,
+                                                                 AV_PKT_DATA_DISPLAYMATRIX);
+            const int32_t *disp_matrix = sd ? (const int32_t *)sd->data : NULL;
             sh_video_t* sh_video;
             BITMAPINFOHEADER *bih;
             sh_video=new_sh_video_vid(demuxer, i, priv->video_streams);
diff -up mplayer-export-2025-09-28/libvo/vo_png.c.7~ mplayer-export-2025-09-28/libvo/vo_png.c
--- mplayer-export-2025-09-28/libvo/vo_png.c.7~	2021-05-01 19:45:29.000000000 +0200
+++ mplayer-export-2025-09-28/libvo/vo_png.c	2025-09-28 16:27:07.606646355 +0200
@@ -126,8 +126,7 @@ config(uint32_t width, uint32_t height,
 
 
     if (avctx && png_format != format) {
-        avcodec_close(avctx);
-        av_freep(&avctx);
+        avcodec_free_context(&avctx);
     }
 
     if (!avctx) {
@@ -214,8 +213,7 @@ query_format(uint32_t format)
 }
 
 static void uninit(void){
-    avcodec_close(avctx);
-    av_freep(&avctx);
+    avcodec_free_context(&avctx);
     av_freep(&outbuffer);
     outbuffer_size = 0;
     free(png_outdir);
diff -up mplayer-export-2025-09-28/sub/av_sub.c.7~ mplayer-export-2025-09-28/sub/av_sub.c
--- mplayer-export-2025-09-28/sub/av_sub.c.7~	2021-05-01 19:45:31.000000000 +0200
+++ mplayer-export-2025-09-28/sub/av_sub.c	2025-09-28 16:27:07.606805215 +0200
@@ -30,8 +30,7 @@ void reset_avsub(struct sh_sub *sh)
         AVCodecContext *ctx = sh->context;
         ctx->extradata = NULL;
         ctx->extradata_size = 0;
-        avcodec_close(sh->context);
-        av_freep(&sh->context);
+        avcodec_free_context((AVCodecContext **)&sh->context);
     }
 }
 
